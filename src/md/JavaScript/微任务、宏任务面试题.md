---
title: 微任务与宏任务面试题
category: JavaScript
tags: [JavaScript, 微任务, 宏任务]
description: 微任务与宏任务面试题
date: 2026-02-08
---

## ① 基础送分题

```js
console.log(1);

setTimeout(() => console.log(2), 0);

Promise.resolve().then(() => console.log(3));

console.log(4);
```

**输出**

```text
1
4
3
2
```

**必错点**

* 以为 `setTimeout(0)` 立刻执行

**结论**

> 微任务一定在下一个宏任务之前执行

---

## ② 微任务套娃题（90% 人懵）

```js
Promise.resolve().then(() => {
  console.log(1);
  Promise.resolve().then(() => console.log(2));
});
```

**输出**

```text
1
2
```

**必错点**

* 以为第二个 `then` 会等下一轮

**结论**

> 微任务中产生的微任务，会追加到**当前微任务队列**

---

## ③ 微任务 vs 宏任务嵌套（高频）

```js
setTimeout(() => {
  console.log(1);
  Promise.resolve().then(() => console.log(2));
}, 0);

Promise.resolve().then(() => console.log(3));
```

**输出**

```text
3
1
2
```

**必错点**

* 把 `2` 当成比 `3` 先执行

**结论**

> **微任务只在“当前宏任务结束后”执行**

---

## ④ 两个 setTimeout，谁先？

```js
setTimeout(() => console.log(1), 0);

setTimeout(() => console.log(2), 0);
```

**输出**

```text
1
2
```

**必错点**

* 怀疑浏览器会“乱序”

**结论**

> 同一个宏任务队列，**FIFO（先进先出）**

---

## ⑤ 微任务阻塞渲染（理解题）

```js
setTimeout(() => console.log('timeout'), 0);

Promise.resolve().then(() => {
  while (true) {}
});
```

**输出**

```text
（无输出，页面卡死）
```

**必错点**

* 以为 setTimeout 还能执行

**结论**

> 微任务不清空，**宏任务永远进不来**

---

## ⑥ Promise.then vs queueMicrotask

```js
queueMicrotask(() => console.log(1));

Promise.resolve().then(() => console.log(2));
```

**输出**

```text
1
2
```

**必错点**

* 以为两者“完全等价、顺序不定”

**结论**

> 它们都进微任务队列，但**注册顺序决定执行顺序**

---

## ⑦ 宏任务里再来宏任务

```js
setTimeout(() => {
  console.log(1);
  setTimeout(() => console.log(2), 0);
}, 0);
```

**输出**

```text
1
2
```

**必错点**

* 以为两个 setTimeout 会同一轮执行

**结论**

> 宏任务里创建的宏任务 → **下一轮事件循环**

---

## ⑧ script 本身是宏任务（重点）

```js
Promise.resolve().then(() => console.log(1));

console.log(2);
```

**输出**

```text
2
1
```

**必错点**

* 以为 Promise 一定“最快”

**结论**

> 微任务要等**当前宏任务（script）结束**

---

## ⑨ 微任务 + 宏任务混合地狱题

```js
setTimeout(() => {
  console.log(1);
}, 0);

Promise.resolve()
  .then(() => {
    console.log(2);
    setTimeout(() => console.log(3), 0);
  })
  .then(() => console.log(4));
```

**输出**

```text
2
4
1
3
```

**必错点**

* 把 `3` 提前
* 忘记 `then` 链仍是微任务

**结论**

> then 链 = 微任务队列
> setTimeout = 新一轮宏任务

---

## ⑩ 终极陷阱题（面试王）

```js
console.log(1);

async function foo() {
  console.log(2);
  await null;
  console.log(3);
}

foo();

console.log(4);
```

**输出**

```text
1
2
4
3
```

**必错点**

* 以为 `await null` 是同步

**结论**

> `await` 后面的代码，本质是 **Promise.then（微任务）**

---

## 🧠 一句话总规律（背这个就够）

> **同步代码先执行
> → 清空微任务
> → 浏览器渲染
> → 执行下一个宏任务**

---